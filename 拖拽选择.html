<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title></title>
		<style>
			ul{
				margin:0;
				padding:0;
				list-style: none;
				width:330px;
				height:330px;
				margin:50px auto 0;
			}
			li{
				width: 100px;
				height: 100px;
				background: red;
				float: left;
				margin-right: 10px;
				margin-bottom: 10px;
			}
			#box{
				background: skyblue;
				position: absolute;
				opacity: 0.5;
				display: none;
			}
		</style>
	</head>
	<body>
		<ul>
			<li></li>
			<li></li>
			<li></li>
			<li></li>
			<li></li>
			<li></li>
			<li></li>
			<li></li>
			<li></li>
		</ul>
		<div id="box"></div>
		<script type="text/javascript">
			var box = document.getElementById('box');
			var lis = document.getElementsByTagName('li');
			var dl,dt;
			var onoff = false;
			var arr = [];
	document.onmousedown = function(ev){
		box.style.display = 'block';
		dl = ev.clientX;
		dt = ev.clientY;
		onoff = true;	
	}
	document.onmousemove = function(ev){			
		if(onoff){
			var nl = ev.clientX;
			var nt = ev.clientY;
			var w = Math.abs(nl-dl);
			var h = Math.abs(nt-dt);
			box.style.width = w+'px';
			box.style.height = h+'px';
			var l = nl>dl?dl:nl;
			var t = nt>dt?dt:nt;
			box.style.left = l+'px';
			box.style.top = t+'px';
			for(var i=0;i<arr.length;i++){
				arr[i].style.background = '';
			}
			arr = [];
			for(var i=0;i<lis.length;i++){
				if(dong(box,lis[i])){
						lis[i].style.background = 'yellow';
						arr.push(lis[i]);
				}
			}
			
		}
		document.onmouseup = function(){
			box.style.display = '';
				box.style.cssText = '';
				onoff = false;
		}
	}
		
		function dong(obj1,obj2){
			var pos1 = obj1.getBoundingClientRect();
			var pos2 = obj2.getBoundingClientRect();
				if(pos1.left>pos2.right || pos1.top>pos2.bottom || pos1.right<pos2.left || pos1.bottom<pos2.top){
					return false;
				}else{
					return true;
				}
		}
		for(var i=0;i<lis.length;i++){
			lis[i].style.left = lis[i].offsetLeft+'px';
			lis[i].style.top = lis[i].offsetTop+'px';
			setTimeout(function(i){
				lis[i].style.position = 'absolute';
			},0,i);
		}
		for(var i=0;i<lis.length;i++){
			lis[i].onmousedown = function(ev){
				//阻止冒泡
				ev.cancelBubble = true;
				if(arr.includes(this)){
					var nL = ev.clientX;
					var nT = ev.clientY;
					for(var i=0;i<arr.length;i++){
						var pos = arr[i].getBoundingClientRect();
						var liL = pos.left;
						var liT = pos.top;
						//自定义属性
						arr[i].disX = nL-liL;
						arr[i].disY = nT-liT;
					}		
					document.onmousemove = function(ev){
						var dL = ev.clientX;
						var dT = ev.clientY;
						for(var i=0;i<arr.length;i++){
							var l = dL-arr[i].disX;
							var t = dT-arr[i].disY;
							arr[i].style.left = l+'px';
							arr[i].style.top = t+'px';
						}
					}
					document.onmouseup = function(){
						document.onmousemove = null;
						document.onmouseup = null;
					}
				}
				
			}
		}
				
		</script>
	</body>
</html>
